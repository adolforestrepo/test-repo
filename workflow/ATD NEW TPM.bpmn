<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"
  xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
  xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC"
  xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI"
  typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath"
  targetNamespace="http://www.activiti.org/test">
  <process id="ATD NEW TPM" name="ATD NEW TPM" isExecutable="true">
  
  	<startEvent id="startWorkflow" name="Start"/> 
    
    <sequenceFlow id="getPIDAndNowString" sourceRef="startWorkflow" targetRef="Get PID and Now String"/>
    
    <serviceTask id="Get PID and Now String" name="Ensure Map" activiti:class="com.reallysi.rsuite.system.workflow.actions.SetDynamicValuesToVariablesActionHandler">
      <activiti:field name="variableNames" stringValue="pId;nowString"/>
      <activiti:field name="pId;nowString" stringValue="pId;nowString"/>
    </serviceTask>
  
    <sequenceFlow id="fromGetPIDToSetVariablesFromProperties" sourceRef="Get PID and Now String" targetRef="Set Variables From Properties"></sequenceFlow>
      
    <serviceTask id="Set Variables From Properties" name="Ensure Map" activiti:class="com.reallysi.rsuite.system.workflow.actions.SetGlobalVariablesActionHandler">
      <activiti:field name="variableNames" stringValue="exportDir;sharedExportDir"/>
      <activiti:field name="values" stringValue="${astd.base.export.dir}${astd.xml.export.dir}/${pId};${astd.export.share}${astd.xml.export.dir}/${pId}"/>
    </serviceTask>

    <sequenceFlow id="fromSetVariablesTo" sourceRef="Set Variables From Properties" targetRef="XML to INCX"></sequenceFlow>

    <serviceTask id="XML to INCX" name="Ensure Map" activiti:class="com.astd.rsuite.actions.AstdXml2IncxActionHandler">
      <activiti:field name="styleCatalogUri" stringValue="rsuite:/res/plugin/astd/xslt/newtpm2indesign/tpm-dita-indesign-style-catalog.xml"/>
      <activiti:field name="xsltUri" stringValue="${sourceFileName}"/>
      <activiti:field name="fileName" stringValue="rsuite:/res/plugin/astd/xslt/newtpm2indesign/tpmArticle2InDesign.xsl"/>
      <activiti:field name="xmlMoId" stringValue="${xmlMoId}"/>
    </serviceTask>

  
    <sequenceFlow id="fromServiceTaskToEndWorkflow" sourceRef="Set Variables From Properties" targetRef="endWorkflow"></sequenceFlow>
    <endEvent id="endWorkflow" name="End Workflow"></endEvent>
    <dataObject id="EXCEPTION_OCCUR" name="EXCEPTION_OCCUR" itemSubjectRef="xsd:string">
      <extensionElements>
        <activiti:value>""</activiti:value>
      </extensionElements>
    </dataObject>
    <dataObject id="rsuiteUserId" name="rsuiteUserId" itemSubjectRef="xsd:string"></dataObject>
  </process>
  
</definitions>